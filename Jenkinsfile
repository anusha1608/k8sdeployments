pipeline {
    agent {
        node {
            label 'java11'
        }
    }
    options {
        timestamps()
        buildDiscarder(logRotator(numToKeepStr: '2', artifactNumToKeepStr: '2'))
        timeout(time: 240;units: 'MINUTES')
        disableConcurrentBuilds
    }
    stages {
        stage ('K8SManifest-Checkout') {
            steps {
                git 'https://github.com/anusha1608/k8sdeployments.git'
            }
        }
        stage ('Kubernetes AutoDeployment') {
            steps {
                dir('manifests')
                {
                    sh 'ls -l'
                    sh 'kubectl --server=https://34.28.87.115 --insecure-skip-tls-verify --token=" LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVMRENDQXBTZ0F3SUJBZ0lRQzdzZEYrVCtpTVdBeU1XYnlZc1U2REFOQmdrcWhraUc5dzBCQVFzRkFEQXYKTVMwd0t3WURWUVFERXlRek1HVmtPVEJpTnkwME5qY3pMVFF5TXpjdE9HTTRNQzFrTkRRek16azNObVpqWlRjdwpJQmNOTWpNd05ERXhNREUxTXpVeldoZ1BNakExTXpBME1ETXdNalV6TlROYU1DOHhMVEFyQmdOVkJBTVRKRE13ClpXUTVNR0kzTFRRMk56TXROREl6TnkwNFl6Z3dMV1EwTkRNek9UYzJabU5sTnpDQ0FhSXdEUVlKS29aSWh2Y04KQVFFQkJRQURnZ0dQQURDQ0FZb0NnZ0dCQUswK21pdXZkbkVLVWlNdXpndkY5M3g0YmVwMmxJdjNMeVI3QjZBdQo3R3dUSDIvUCtNTVdJQlBZVjdUb1FwQXBSYzIrQ0J4bXpQUkQ2Y1VhT0FHSG9qTHovdnlpeWlJWDFJK2hyTjRyCjFPOVM3YXVlOGtWL0grRzIzZFd1R2FOL25GTlJISi8ySldBaElZYTA0bzN5WS9OUVQ5NmozNUZmMmRycDFQQ28KMUFDU05ObS9SQWtGU1pRaTR0Zld6TzFEd1I2RlpXMTRQVm5SQ045ZDFFN0hqVnpDV0Z0Q3VLYW5aS1c2Lzd5VQpZd0U5eCttRkR1N2NKR0RVSXNWcDY5Yjd2dEcra2FUL0t0eUtHOFZRbHlCSmQ3RE5SMENDQjdsWFdpaGVlZ0JaCjJBVHY0TUdPd3FMMkkwSVVSdUE0NTdpaGhjZThHOVdPdkpicFZITHBsbElvKzE2T3FjZ2RuaXdQYm43MExUSGcKNHpsYlNiRHN3dWcwcTQwUXI3YmduR0M3N21xWXdPNG9nblAxUU9LM0xqdXRESSsrUHBjbmp2THgzV0h3MHluNgpia0RyaG1xQ21uWlBzNFpDMXdFcTZ6YmdVd2VQTnFxMVduNy9QVEwvSmZaZDJQeHI5NXVaVXYxS1FqRGp1ejkzCnRESG9EM3JXbDNjTUs3WW94NFljQ28zQnpRSURBUUFCbzBJd1FEQU9CZ05WSFE4QkFmOEVCQU1DQWdRd0R3WUQKVlIwVEFRSC9CQVV3QXdFQi96QWRCZ05WSFE0RUZnUVV6SkpDUE5ObFY4QzZqOUxaOHpYQUdQR3YyakV3RFFZSgpLb1pJaHZjTkFRRUxCUUFEZ2dHQkFGV0ZhTUp2L1JhbmhxREtrRloxUzNydXRQbW9jdDd6d2sxTlFYK3hCZUNICitpZ3FvUmRhbUVSS09sYlpUVjdXM2RUZDFPRFpsbUxWMWZ5ajcvYTRaRW1CZG41TVdCWkc5dDdWYTRFd2RWd0oKbjFQUUVicUlNanc2SExUOXpKSXZQREREdVVUdFR4OTgxcWtqRTlMNUlHMkZnTmFpekZraGF5UVNmUnpYV042TQpha2FybUZmNFhGdFoxdlJ2M2lackJ6c1FpNEtXUWxjSXRtRU5Gb1huUkp3TW81cWJNSVhwb0lScUY4U0tWcEZ3CmZjN3R3ellieWcvSEp1aXNDL1R2RHFyUVArUEpNbnlNdmo0SVNaY0NDZXIzMlhCU3BicFZRcEZQek5qNlMyc3MKT0dHY3J5c3hybTJ5M3Y3cE9MM2cwa0tPT3pQcGxob0xPTmRnMnMvVHptK0FBaE8xd2hVblZEUThQUzRGTzZzdwpRbEFyWFlpNmJpY21tTDhYa1JjVWN2Wmp1S1BMZmNic2Y2ejFxN01wQVhuUTJPR2NzbDc3bVpvY0RvdTlZRUhYCnFORTNUbzlEd01QOGQ1czVIc0xyL2hCbXlRRU5KR2tHb21HMnNHMTFuZTNJRlBUVGlnc3VWdUZQNllscFlEb00KZWRpNUpmU09WaytYbWNkS2NwZW5vQT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K" apply -f deployment.yml'
                    sh 'kubectl --server=https://34.28.87.115 --insecure-skip-tls-verify --token=" LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVMRENDQXBTZ0F3SUJBZ0lRQzdzZEYrVCtpTVdBeU1XYnlZc1U2REFOQmdrcWhraUc5dzBCQVFzRkFEQXYKTVMwd0t3WURWUVFERXlRek1HVmtPVEJpTnkwME5qY3pMVFF5TXpjdE9HTTRNQzFrTkRRek16azNObVpqWlRjdwpJQmNOTWpNd05ERXhNREUxTXpVeldoZ1BNakExTXpBME1ETXdNalV6TlROYU1DOHhMVEFyQmdOVkJBTVRKRE13ClpXUTVNR0kzTFRRMk56TXROREl6TnkwNFl6Z3dMV1EwTkRNek9UYzJabU5sTnpDQ0FhSXdEUVlKS29aSWh2Y04KQVFFQkJRQURnZ0dQQURDQ0FZb0NnZ0dCQUswK21pdXZkbkVLVWlNdXpndkY5M3g0YmVwMmxJdjNMeVI3QjZBdQo3R3dUSDIvUCtNTVdJQlBZVjdUb1FwQXBSYzIrQ0J4bXpQUkQ2Y1VhT0FHSG9qTHovdnlpeWlJWDFJK2hyTjRyCjFPOVM3YXVlOGtWL0grRzIzZFd1R2FOL25GTlJISi8ySldBaElZYTA0bzN5WS9OUVQ5NmozNUZmMmRycDFQQ28KMUFDU05ObS9SQWtGU1pRaTR0Zld6TzFEd1I2RlpXMTRQVm5SQ045ZDFFN0hqVnpDV0Z0Q3VLYW5aS1c2Lzd5VQpZd0U5eCttRkR1N2NKR0RVSXNWcDY5Yjd2dEcra2FUL0t0eUtHOFZRbHlCSmQ3RE5SMENDQjdsWFdpaGVlZ0JaCjJBVHY0TUdPd3FMMkkwSVVSdUE0NTdpaGhjZThHOVdPdkpicFZITHBsbElvKzE2T3FjZ2RuaXdQYm43MExUSGcKNHpsYlNiRHN3dWcwcTQwUXI3YmduR0M3N21xWXdPNG9nblAxUU9LM0xqdXRESSsrUHBjbmp2THgzV0h3MHluNgpia0RyaG1xQ21uWlBzNFpDMXdFcTZ6YmdVd2VQTnFxMVduNy9QVEwvSmZaZDJQeHI5NXVaVXYxS1FqRGp1ejkzCnRESG9EM3JXbDNjTUs3WW94NFljQ28zQnpRSURBUUFCbzBJd1FEQU9CZ05WSFE4QkFmOEVCQU1DQWdRd0R3WUQKVlIwVEFRSC9CQVV3QXdFQi96QWRCZ05WSFE0RUZnUVV6SkpDUE5ObFY4QzZqOUxaOHpYQUdQR3YyakV3RFFZSgpLb1pJaHZjTkFRRUxCUUFEZ2dHQkFGV0ZhTUp2L1JhbmhxREtrRloxUzNydXRQbW9jdDd6d2sxTlFYK3hCZUNICitpZ3FvUmRhbUVSS09sYlpUVjdXM2RUZDFPRFpsbUxWMWZ5ajcvYTRaRW1CZG41TVdCWkc5dDdWYTRFd2RWd0oKbjFQUUVicUlNanc2SExUOXpKSXZQREREdVVUdFR4OTgxcWtqRTlMNUlHMkZnTmFpekZraGF5UVNmUnpYV042TQpha2FybUZmNFhGdFoxdlJ2M2lackJ6c1FpNEtXUWxjSXRtRU5Gb1huUkp3TW81cWJNSVhwb0lScUY4U0tWcEZ3CmZjN3R3ellieWcvSEp1aXNDL1R2RHFyUVArUEpNbnlNdmo0SVNaY0NDZXIzMlhCU3BicFZRcEZQek5qNlMyc3MKT0dHY3J5c3hybTJ5M3Y3cE9MM2cwa0tPT3pQcGxob0xPTmRnMnMvVHptK0FBaE8xd2hVblZEUThQUzRGTzZzdwpRbEFyWFlpNmJpY21tTDhYa1JjVWN2Wmp1S1BMZmNic2Y2ejFxN01wQVhuUTJPR2NzbDc3bVpvY0RvdTlZRUhYCnFORTNUbzlEd01QOGQ1czVIc0xyL2hCbXlRRU5KR2tHb21HMnNHMTFuZTNJRlBUVGlnc3VWdUZQNllscFlEb00KZWRpNUpmU09WaytYbWNkS2NwZW5vQT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K" apply -f service.yml'
                    echo 'Done'
                    sh 'kubectl get deployments'
                    sh 'sleep 60; kubectl get services'
                }
            }
        }
    }
}